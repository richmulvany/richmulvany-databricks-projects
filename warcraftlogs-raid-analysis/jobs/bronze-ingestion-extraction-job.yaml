name: bronze-ingestion-extraction-job
tasks:
  - task_key: bronze_ingestion-task
    for_each_task:
      inputs: '["fights", "actors", "events", "tables"]'
      concurrency: 1
      task:
        task_key: bronze_ingestion_iteration
        notebook_task:
          notebook_path: /Workspace/Users/ricard.mulvany@gmail.com/richmulvany-databricks-projects/warcraftlogs-raid-analysis/notebooks/01-bronze/bronze-ingestion
          base_parameters:
            report_id: rVnDB4fcb9qZAPLv
            fight_id: ""
            data_source: "{{input}}"
          source: WORKSPACE
        min_retry_interval_millis: 900000
        disable_auto_optimization: true

  - task_key: bronze_extraction-task
    depends_on:
      - task_key: bronze_ingestion-task
    for_each_task:
      inputs: '["fights", "actors", "events", "tables"]'
      concurrency: 1
      task:
        task_key: bronze_extraction_iteration
        notebook_task:
          notebook_path: /Workspace/Users/ricard.mulvany@gmail.com/richmulvany-databricks-projects/warcraftlogs-raid-analysis/notebooks/01-bronze/bronze-extraction
          base_parameters:
            report_id: "{{parameters.bronze_ingestion_iteration.values.report_id}}"
            fight_id: ""
            data_source: "{{input}}"
          source: WORKSPACE

queue:
  enabled: true
performance_target: STANDARD
