name: Deploy WarcraftLogs Bundle
 ##
 
on:
  push:
    paths:
      - 'warcraftlogs-raid-analysis/**'
 
jobs:
  deploy-and-run:
    runs-on: ubuntu-latest
 
    steps:
      - uses: actions/checkout@v3
      - uses: databricks/setup-cli@main
 
      - name: Deploy Bundle
        run: databricks bundle deploy
        working-directory: warcraftlogs-raid-analysis
        env:
          DATABRICKS_TOKEN: ${{ secrets.DATABRICKS_TOKEN }}
          DATABRICKS_BUNDLE_ENV: default
 
      - name: Run Job
        run: databricks bundle run warcraft-job --refresh-all
        working-directory: warcraftlogs-raid-analysis
        env:
          DATABRICKS_TOKEN: ${{ secrets.DATABRICKS_TOKEN }}
          DATABRICKS_BUNDLE_ENV: default
