name: "Warcraftlogs: Deploy"

on:
  push:
    branches:
      - main
    paths:
      - ".github/workflows/warcraftlogs-deploy.yml"
      - "warcraftlogs-raid-analysis/**"
  pull_request:
    branches:
      - main
    paths:
      - ".github/workflows/warcraftlogs-deploy.yml"
      - "warcraftlogs-raid-analysis/**"

  permissions:
    id-token: write
    contents: read

  jobs:
    test-notebooks:
      name: Lint & Test Notebooks
      runs-on: ubuntu-latest
      steps:
        - name: Git checkout
          uses: actions/setup-python@v5
          with:
            python-version: "3.13"

        - name: Install Dependencies
          run: python -m pip install --upgrade pip flake8

        # No tests yet
        - name: Run tests
          run: echo "No tests!"

    build:
      name: Build
      uses: .github/workflows/databricks-build.yml
      with:
        directory: warcraftlogs-raid-analysis

    deploy:
      name: Deploy
      if: ( github.event_name == 'push' && github.ref == 'refs/heads/main' )
      uses: .github/workflows/databricks-deploy-yml
      needs:
        - test-notebooks
        - build
      with:
        artefact-name: ${{ needs.build.outputs.artefact-name }}
