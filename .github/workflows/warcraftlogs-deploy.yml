name: Deploy WarcraftLogs Bundle
 ##
 
on:
  push:
    paths:
      - 'warcraftlogs-raid-analysis/**'
 
jobs:
  deploy-and-run:
    runs-on: ubuntu-latest
 
    steps:
      - uses: actions/checkout@v3
      - uses: databricks/setup-cli@main
 
      - name: Deploy Bundle and Run Job
        run: |
         databricks bundle deploy
         databricks bundle run warcraft-job --refresh-all
        working-directory: warcraftlogs-raid-analysis
        env:
          DATABRICKS_TOKEN: ${{ secrets.SP_TOKEN }}
          DATABRICKS_BUNDLE_ENV: default
          DATABRICKS_HOST_ADDRESS: ${{ vars.DATABRICKS_HOST_ADDRESS }}
          DATABRICKS_CLUSTER_ID: ${{ vars.DATABRICKS_CLUSTER_ID }}
          
      - name: üîç Show environment variables
        run: |
          echo "DATABRICKS_HOST_ADDRESS = $DATABRICKS_HOST_ADDRESS"
          echo "DATABRICKS_CLUSTER_ID = $DATABRICKS_CLUSTER_ID"
        env:
          DATABRICKS_HOST_ADDRESS: ${{ vars.DATABRICKS_HOST_ADDRESS }}
          DATABRICKS_CLUSTER_ID: ${{ vars.DATABRICKS_CLUSTER_ID }}
